# SipServer

–ü—Ä–æ—Ç–æ—Ç–∏–ø SIP-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ Go, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –±–∞–∑–æ–≤—É—é SIP-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –≤—ã–∑–æ–≤–æ–≤ —á–µ—Ä–µ–∑ `302 Moved Temporarily` (redirect), –±–µ–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞.

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É—á–µ–±–Ω—ã—Ö –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á—É—é SIP-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ B2BUA –∏–ª–∏ SIP-proxy.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìû –û–±—Ä–∞–±–æ—Ç–∫–∞ SIP –º–µ—Ç–æ–¥–æ–≤:
  - `REGISTER`
  - `INVITE`
  - `ACK`
- üìç –†–µ–∞–ª–∏–∑–∞—Ü–∏—è **SIP Registrar** (location service)
- üîÅ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ —á–µ—Ä–µ–∑ `302 Moved Temporarily`
- üß† –•—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ Contact –¥–ª—è –∞–±–æ–Ω–µ–Ω—Ç–∞
- ‚è± –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`Expires`)
- üåê –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ NAT (—á–µ—Ä–µ–∑ source IP/port)
- üß™ –°–æ–≤–º–µ—Å—Ç–∏–º —Å SIP-–∫–ª–∏–µ–Ω—Ç–∞–º–∏:
  - Zoiper (desktop / mobile)
- üêß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ Linux

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–µ—Ä–≤–µ—Ä —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é SIP-—Å—Ö–µ–º—É:

```
SIP Client (UAC)
     |
     | REGISTER / INVITE
     v
SipServer (Registrar + Redirect)
     |
     | 302 Moved Temporarily
     v
SIP Client (UAS)
```

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Go
- sipgo (https://github.com/emiago/sipgo)
- UDP transport
- tcpdump –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ SIP/RTP

---

## –ó–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/usernaimandrey/SipServer.git
cd SipServer
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
make run
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç UDP –ø–æ—Ä—Ç `5060`.

---

## –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è —Ä–∞–±–æ—Ç—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–±–æ–Ω–µ–Ω—Ç–∞

```text
REGISTER sip:server:5060
Contact: <sip:1001@192.168.0.21:49831>
```

–°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç:

```text
1001 ‚Üí 192.168.0.21:49831
```

---

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–∑–æ–≤–∞

1. –ö–ª–∏–µ–Ω—Ç A –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç INVITE:

```text
INVITE sip:1001@server
```

2. –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:

```text
302 Moved Temporarily
Contact: <sip:1001@192.168.0.21:49831>
```

3. –ö–ª–∏–µ–Ω—Ç A –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π INVITE –Ω–∞–ø—Ä—è–º—É—é –∫–ª–∏–µ–Ω—Ç—É B

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ùå –ù–µ—Ç SIP Digest Authentication
- ‚ùå –ù–µ—Ç TLS
- ‚ùå –ù–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è RTP
- ‚ùå –ù–µ—Ç B2BUA (—Å–µ—Ä–≤–µ—Ä –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–µ –ø–æ—Å–ª–µ 302)

–ü—Ä–æ–µ–∫—Ç –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è production –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö.

---

## –û—Ç–ª–∞–¥–∫–∞

–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# SIP —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è
sudo tcpdump -ni any -s 0 -A udp port 5060

# SIP –ø–æ—Å–ª–µ redirect
sudo tcpdump -ni any -s 0 -A udp port 49831

# RTP
sudo tcpdump -ni any udp portrange 10000-65000
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- SIP Digest Authentication (401 / Authorization)
- NAT keepalive (OPTIONS)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TCP / TLS
- –ü—Ä–æ–∫—Å–∏-—Ä–µ–∂–∏–º –≤–º–µ—Å—Ç–æ redirect
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –≤ –ë–î
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Contact –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö.  
–ê–≤—Ç–æ—Ä: **usernaimandrey**

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
